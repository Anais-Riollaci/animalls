<?phpnamespace App\Controller;use App\Entity\Animal;use App\Repository\AnimalRepository;use App\Repository\CategoryRepository;use App\Repository\RaceRepository;use App\Repository\SpecieRepository;use Doctrine\ORM\EntityManagerInterface;use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;use Symfony\Component\Form\Extension\Core\Type\ChoiceType;use Symfony\Component\Form\Extension\Core\Type\NumberType;use Symfony\Component\Form\Extension\Core\Type\SubmitType;use Symfony\Component\Form\Extension\Core\Type\TextType;use Symfony\Component\HttpFoundation\Request;use Symfony\Component\Routing\Annotation\Route;/** * Class AnimalProfileController */class AnimalProfileController extends AbstractController{    /**     * @Route("/profile/{id}", name="profile_show")     */    public function showProfile($id, EntityManagerInterface $manager, AnimalRepository $animalRepository)    {        $repository = $manager->getRepository(Animal::class);        $animal = $repository->find($id);        return $this->render('animal/Profile.html.twig',            [                'animal' => $animal            ]        );    }    /**     * @Route("/search", name="search_profile")     */    public function searchProfile(        Request $request,        CategoryRepository $categoryRepository,        SpecieRepository $specieRepository,        AnimalRepository $animalRepository,        RaceRepository $raceRepository    )    {        $speciesFromDb = $specieRepository->findAll();        $species = [];        foreach ($speciesFromDb as $item) {            $species[$item->getName()] = $item->getId();        }        $racesFromDb = $raceRepository->findAll();        $races = [];        foreach ($racesFromDb as $item) {            $races[$item->getName()] = $item->getId();        }        $categoryFromDb = $categoryRepository->findAll();        $category = [];        foreach ($categoryFromDb as $cate) {            $category[$cate->getTitle()] = $cate->getId();        }        $form = $this->createFormBuilder()            ->add('types',                ChoiceType::class,                [                    'required' => false,                    'placeholder' => 'Choisissez un type',                    'choices' => $species                ]            )            ->add('race',                ChoiceType::class,                [                    'required' => false,                    'placeholder' => 'Toutes les races',                    'choices' => $races,                ]            )            ->add('sexe',                ChoiceType::class,                [                    'empty_data' => null,                    'required' => false,                    'choices' => [                        'Tous' => null,                        'Mâle' => 'm',                        'Femelle' => 'f',                    ],                ])            ->add('age', NumberType::class, [                    'html5' => true,                    'required' => false,                    'attr' => [                        'min' => 1,                        'max' => 10                    ],                ]            )            ->add('categories',                ChoiceType::class,                [                    'required' => false,                    'placeholder' => 'Choisissez une catégorie',                    'choices' => $category                ])            ->add('save', SubmitType::class, [                'label' => 'Enregistrer'            ])            ->getForm();        $qb = $animalRepository->createQueryBuilder("animal");        $form->handleRequest($request);        if ($form->isSubmitted() && $form->isValid()) {            $data = $form->getData();//            print_r($data); die;            if (isset($data["sexe"]) && !empty($data["sexe"])) {                $qb->andWhere("animal.gender = :gender")->setParameter("gender", $data["sexe"]);            }            if (isset($data["types"]) && !empty($data["types"])) {                $qb->innerJoin("animal.species", "species");                $qb->andWhere("species.id = :species_id")->setParameter("species_id", $data["types"]);            }            if (isset($data["race"]) && !empty($data["race"])) {                $qb->innerJoin("animal.race", "race");                $qb->andWhere("race.id = :race_id")->setParameter("race_id", $data["race"]);            }        }        $animals = $qb->getQuery()->execute();        return $this->render('animal/SearchProfile.html.twig',            [                "animals" => $animals,                'ProfileSearch' => $form->createView()            ]);    }    /**     * @Route("/ajax/species/{id}/races", name="ajax_get_races_select")     */    public function ajaxGetRacesSelect(int $id, RaceRepository $raceRepository)    {        $races = $raceRepository->findBy([            "species" => ["id" => $id]        ]);        return $this->render('animal/SelectRace.html.twig',            [                "id" => $id,                "races" => $races            ]        );    }}